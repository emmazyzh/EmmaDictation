<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dictation Practice Tool</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; position: relative; overflow-x: hidden; }
    textarea { width: 80%; height: 100px; font-size: 1em; padding: 0.5em; margin: 0.5em; }
    #status { margin-top: 1em; font-weight: bold; }
    .icon-btn { font-size: 1em; padding: 0.7em 1.5em; margin: 0.3em; border: none; border-radius: 5px; cursor: pointer; background-color: #4CAF50; color: white; }
    .voice-toggle { position: absolute; right: 10%; margin-top: -120px; text-align: right; }
    #voiceSelect { padding: 0.5em; font-size: 1em; }
    #progress { margin-top: 1em; font-size: 1em; }
    #ribbons {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
      background: url('https://i.imgur.com/TFdUbJF.png') center center no-repeat;
      background-size: contain;
    }
  </style>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
  <h1>Dictation Tool</h1>

  <div class="voice-toggle">
    <label for="voiceSelect">Voice:</label>
    <select id="voiceSelect">
      <option value="Evan">Evan</option>
      <option value="Tom">Tom</option>
      <option value="Samantha">Samantha</option>
      <option value="Zoe">Zoe</option>
    </select>
  </div>

  <p>Enter a comma-separated list of words:</p>
  <textarea id="wordInput" placeholder="e.g., apple, banana, chocolate"></textarea>

  <div class="controls">
    <button id="startBtn" class="icon-btn">Start Dictation</button>
    <button onclick="nextWord()" class="icon-btn">Next</button>
    <button onclick="playPreviousWord()" class="icon-btn">Last</button>
    <button onclick="repeatCurrentWord()" class="icon-btn">Repeat</button>
  </div>

  <p id="progress"></p>
  <p id="status">Status: Waiting for input...</p>
  <div id="ribbons"></div>

  <script>
    let words = [];
    let index = 0;
    let recognition;
    let voices = [];
    let selectedVoice = null;
    let isDictating = false;
    let wentBack = false;

    function populateVoices() {
      voices = speechSynthesis.getVoices();
      const defaultVoiceName = document.getElementById('voiceSelect').value;
      selectedVoice = voices.find(v => v.name === defaultVoiceName) || voices[0];
    }

    speechSynthesis.onvoiceschanged = populateVoices;

    document.getElementById('voiceSelect').addEventListener('change', () => {
      const voiceName = document.getElementById('voiceSelect').value;
      selectedVoice = voices.find(v => v.name === voiceName) || voices[0];
    });

    function speakText(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'en-US';
      utter.voice = selectedVoice;
      speechSynthesis.speak(utter);
    }

    function updateProgress() {
      document.getElementById('progress').textContent = `Progress: ${Math.min(index, words.length)} / ${words.length}`;
    }

    function showRibbons() {
      const ribbonDiv = document.getElementById('ribbons');
      ribbonDiv.style.display = 'block';
      setTimeout(() => {
        ribbonDiv.style.display = 'none';
      }, 3000);
    }

    function listenNextCommand() {
      if (!('webkitSpeechRecognition' in window)) {
        document.getElementById('status').textContent = 'SpeechRecognition not supported in this browser.';
        return;
      }

      recognition = new webkitSpeechRecognition();
      recognition.lang = 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript.toLowerCase();
        document.getElementById('status').textContent = `Heard: "${transcript}"`;

        if (transcript.includes("next") || transcript.includes("move on") || transcript.includes("done") || transcript.includes("finished") || transcript.includes("completed")) {
          if (index >= words.length) {
            speakText('Great job! You finished the dictation! See you next time.');
            document.getElementById('status').textContent = 'Great job! You finished the dictation! See you next time.';
            showRibbons();
            return;
          }
          nextWord();
        } else if (transcript.includes("again") || transcript.includes("repeat") || transcript.includes("pardon")) {
          repeatCurrentWord();
        } else if (transcript.includes("last") || transcript.includes("previous") || transcript.includes("back")) {
          playPreviousWord();
        } else {
          listenNextCommand();
        }
      };

      recognition.onerror = (event) => {
        document.getElementById('status').textContent = `Error: ${event.error}`;
        listenNextCommand();
      };

      recognition.start();
    }

    function repeatCurrentWord() {
      if (index > 0 && index <= words.length) {
        const word = words[index - 1];
        speakText(word);
        setTimeout(() => listenNextCommand(), 1000);
      } else {
        listenNextCommand();
      }
    }

    function playPreviousWord() {
      if (index <= 1 || wentBack) {
        listenNextCommand();
        return;
      }
      index -= 2;
      wentBack = true;
      nextWord();
    }

    function nextWord() {
      if (!isDictating) return;
      if (index < words.length) {
        wentBack = false;
        const word = words[index++];
        document.getElementById('status').textContent = `Word: ${word}`;
        updateProgress();
        speakText(word);
        setTimeout(() => listenNextCommand(), 1000);
      } else {
        document.getElementById('status').textContent = 'Great job! You finished the dictation! See you next time.';
        speakText('Great job! You finished the dictation! See you next time.');
        showRibbons();
        updateProgress();
        isDictating = false;
      }
    }

    function startDictation() {
      const voiceName = document.getElementById('voiceSelect').value;
      selectedVoice = voices.find(v => v.name === voiceName) || voices[0];
      words = document.getElementById('wordInput').value.split(',').map(w => w.trim()).filter(Boolean);
      index = 0;
      wentBack = false;
      if (words.length === 0) {
        document.getElementById('status').textContent = 'Please enter some words.';
        return;
      }
      isDictating = true;
      document.getElementById('status').textContent = 'Starting dictation...';
      updateProgress();
      nextWord();
    }

    document.getElementById('startBtn').onclick = startDictation;
  </script>
</body>
</html>
